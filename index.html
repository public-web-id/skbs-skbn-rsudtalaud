<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si Sehat - RSUD Talaud</title>
    
    <!-- Menggunakan Font Awesome untuk Ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- html2canvas library untuk mengubah form menjadi gambar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- FileSaver.js untuk download file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        /* --- Gaya Umum & Reset --- */
        :root {
            --primary-color: #4364F7;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-color: #6c757d;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --border-color: #e0e6ed;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.08);
            --card-shadow-hover: 0 15px 40px rgba(0,0,0,0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, #f0f4f8, #d9e2ec);
            color: var(--dark-color);
            line-height: 1.6;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* --- Gaya untuk Opening Screen --- */
        .opening-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            color: white;
            text-align: center;
            padding: 20px;
            overflow-y: auto;
            transition: all 0.5s ease;
        }

        .opening-screen.hidden {
            opacity: 0;
            transform: scale(0.9);
            visibility: hidden;
        }

        .opening-logo {
            margin-bottom: 30px;
            animation: fadeInDown 1s ease;
        }

        .opening-logo img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .opening-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            animation: fadeInUp 1s ease 0.2s both;
        }

        .opening-subtitle {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 30px;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.4s both;
        }

        .opening-description {
            max-width: 500px;
            margin-bottom: 40px;
            font-size: 1rem;
            line-height: 1.8;
            opacity: 0.95;
            animation: fadeInUp 1s ease 0.6s both;
        }

        .opening-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            max-width: 600px;
            animation: fadeInUp 1s ease 0.8s both;
        }

        .feature-item {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 15px 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex: 1;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
        }

        .feature-item i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .feature-item h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .feature-item p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .btn-continue {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeInUp 1s ease 1s both;
        }

        .btn-continue:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .btn-continue:active {
            transform: scale(0.98);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Container diperbesar dari 480px menjadi 600px */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }

        /* --- Header --- */
        header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .logo-container {
            margin-bottom: 15px;
        }

        /* Logo diperbesar */
        .logo-container img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .header-title {
            text-align: center;
            margin-bottom: 15px;
        }

        /* Font judul diperbesar */
        header h1 {
            font-size: 1.7rem;
            font-weight: 700;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        /* Font sub-judul diperbesar */
        header p {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .header-time {
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--dark-color);
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--card-shadow);
            width: 100%;
        }

        /* Font waktu diperbesar */
        .current-time {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        /* --- Gaya untuk Halaman Beranda (Opening) --- */
        .opening-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px; /* Padding diperbesar */
            margin-top: 25px;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        /* Font judul card diperbesar */
        .opening-card h2 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        .choice-button {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 18px; /* Padding diperbesar */
            background-color: #fdfdfd;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--dark-color);
            position: relative;
            overflow: hidden;
        }
        
        /* Ikon diperbesar */
        .choice-button i {
            font-size: 1.7rem;
            margin-right: 15px;
            color: var(--primary-color);
        }
        .choice-button:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--card-shadow-hover);
        }
        
        /* Font tombol pilihan diperbesar */
        .choice-button .button-text h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .choice-button .button-text p {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        /* --- Area Upload KTP --- */
        .ktp-upload-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px; /* Padding diperbesar */
            margin-top: 25px;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .ktp-upload-section.processing {
            opacity: 0.6;
            pointer-events: none;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 30px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fdfdfd;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: #f0f4ff;
        }

        /* Ikon upload diperbesar */
        .upload-area i {
            font-size: 2.2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .upload-area p {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .upload-area span {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.85rem;
        }

        #ktpUploadInput {
            display: none;
        }

        .upload-result {
            display: none;
            margin-top: 20px;
        }

        /* Preview gambar diperbesar */
        .upload-result img {
            max-width: 180px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-bottom: 15px;
        }

        .upload-status {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .upload-status.success {
            color: var(--success-color);
        }

        .upload-status.error {
            color: var(--danger-color);
        }

        /* --- Konten Utama (Formulir & Alur Layanan) --- */
        main {
            padding: 15px 0;
            transition: all 0.3s ease;
        }

        .content-section {
            display: none;
            opacity: 0;
            transition: all 0.4s ease-in-out;
            transform: translateY(20px);
        }
        
        .content-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .form-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px; /* Padding diperbesar */
            margin-top: 25px;
            box-shadow: var(--card-shadow);
            transition: all 0.4s ease, box-shadow 0.4s ease;
            position: relative;
        }
        
        .form-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow-hover);
        }

        /* Font judul form diperbesar */
        .form-card h2 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            padding-left: 15px;
            border-left: 5px solid var(--primary-color);
        }

        .form-group {
            margin-bottom: 18px;
        }

        /* Font label form diperbesar */
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px; /* Padding diperbesar */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem; /* Font diperbesar */
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            background-color: #fdfdfd;
        }
        
        .form-group input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.8;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 100, 247, 0.2);
            background-color: white;
        }
        
        /* Gaya untuk Radio Button Jenis Kelamin */
        .radio-group {
            display: flex;
            gap: 20px;
        }
        .radio-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .radio-item input[type="radio"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .radio-item label {
            cursor: pointer;
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        /* Tombol */
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            display: inline-block;
            padding: 12px 25px; /* Padding diperbesar */
            font-size: 1rem; /* Font diperbesar */
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex-grow: 1;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 100, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 100, 247, 0.4);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-primary:disabled {
            background: var(--secondary-color);
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
        }

        .btn-secondary:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        /* --- Gaya untuk Timeline Alur Layanan --- */
        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-marker {
            position: absolute;
            left: -32px;
            top: 5px;
            width: 30px;
            height: 30px;
            background-color: white;
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: 700;
            z-index: 1;
        }

        /* Font judul timeline diperbesar */
        .timeline-content h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        /* Font paragraf timeline diperbesar */
        .timeline-content p {
            font-size: 0.9rem;
            color: var(--secondary-color);
            line-height: 1.6;
        }
        
        .timeline-content strong {
            color: var(--dark-color);
            font-weight: 600;
        }

        .timeline-content .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid var(--info-color);
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .timeline-content .info-box p {
            margin-bottom: 0;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        .timeline-content .info-box strong {
            color: var(--info-color);
        }

        /* Notifikasi */
        .notification {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            max-width: 90%;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
        }

        .notification i {
            font-size: 1.2rem;
        }

        .notification.success {
            background-color: white;
            color: var(--success-color);
            border-left: 5px solid var(--success-color);
        }
        
        .notification.error {
            background-color: white;
            color: var(--danger-color);
            border-left: 5px solid var(--danger-color);
        }

        /* --- Footer & Menu Bawah --- */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--primary-gradient);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        footer nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0; /* Padding diperbesar */
        }

        footer nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 0.7rem; /* Font diperbesar */
            transition: all 0.3s ease;
            padding: 5px;
            position: relative;
        }
        
        footer nav a.disabled {
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }

        /* Ikon footer diperbesar */
        footer nav a i {
            font-size: 1.2rem;
            margin-bottom: 3px;
            transition: transform 0.3s ease;
        }

        footer nav a.active {
            color: white;
        }
        
        footer nav a.active::before {
            content: '';
            position: absolute;
            top: -5px;
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
        }

        footer nav a:not(.disabled):hover {
            color: white;
        }
        
        footer nav a:not(.disabled):hover i {
            transform: translateY(-3px);
        }

        /* Jenis Pendaftaran Card */
        .registration-type-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px; /* Padding diperbesar */
            margin: 25px auto;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: all 0.3s ease;
        }

        /* Font judul kartu jenis pendaftaran diperbesar */
        .registration-type-card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        /* Tambahkan gaya untuk info lokasi */
        .location-info {
            background-color: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .location-info p {
            margin-bottom: 0;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        .location-info strong {
            color: #e6a800;
        }

        /* Gaya untuk form lock overlay */
        .form-lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .lock-icon {
            font-size: 3rem;
            color: var(--danger-color);
            margin-bottom: 15px;
        }

        .lock-message {
            text-align: center;
            padding: 0 20px;
        }

        .lock-message h3 {
            font-size: 1.2rem;
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .lock-message p {
            font-size: 0.9rem;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .choice-button.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* Gaya untuk modal kode daftar */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: var(--card-shadow-hover);
            text-align: center;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .close {
            color: var(--secondary-color);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: var(--dark-color);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .kode-daftar {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            padding: 15px;
            background-color: #f0f4ff;
            border-radius: 10px;
            margin: 20px 0;
            letter-spacing: 1px;
        }

        .warning-box {
            background-color: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: left;
        }

        .warning-box p {
            margin-bottom: 0;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-download {
            background-color: var(--success-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-download:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        /* Gaya untuk form gambar yang akan dikirim ke Telegram */
        #formImageContainer {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 600px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-image-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .form-image-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .form-image-code {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            background-color: #f0f4ff;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .form-image-content {
            margin-bottom: 20px;
        }

        .form-image-section {
            margin-bottom: 15px;
        }

        .form-image-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .form-image-field {
            display: flex;
            margin-bottom: 8px;
        }

        .form-image-label {
            font-weight: 600;
            width: 150px;
            color: var(--secondary-color);
        }

        .form-image-value {
            flex: 1;
            color: var(--dark-color);
        }

        .form-image-footer {
            text-align: center;
            font-size: 0.9rem;
            color: var(--secondary-color);
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
        }

        /* Gaya untuk KTP dengan kode */
        #ktpWithCodeContainer {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 400px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ktp-code-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 900; /* Menggunakan font-weight 900 untuk teks paling tebal */
            color: var(--primary-color);
            font-size: 1rem;
            text-align: right;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border: 2px solid var(--primary-color);
            max-width: 150px;
        }

        .ktp-code {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .ktp-time {
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .ktp-image-container {
            position: relative;
            display: inline-block;
        }

        .ktp-image-container img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        /* Gaya untuk gambar KTP di dalam form */
        .form-image-ktp {
            margin-top: 15px;
            text-align: center;
        }

        .form-image-ktp-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .form-image-ktp-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }

        .form-image-ktp-container img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body>

    <!-- Opening Screen -->
    <div class="opening-screen" id="openingScreen">
        <div class="opening-logo">
            <img src="https://z-cdn-media.chatglm.cn/files/b4d36e42-0be2-452f-8e16-e5eeab08ede5_talaud_400kb.png?auth_key=1864643267-608b935f262943e18f44268f65ab014d-0-20d1a2c006a0416ea1fb36417d8eea78" alt="Logo RSUD Talaud">
        </div>
        <h1 class="opening-title">Selamat Datang di Si Sehat</h1>
        <p class="opening-subtitle">Sistem Informasi Kesehatan RSUD Talaud</p>
        
        <div class="opening-description">
            <p>Si Sehat merupakan aplikasi digital yang dirancang untuk mempermudah masyarakat dalam melakukan pendaftaran online untuk penerbitan Surat Keterangan Berbadan Sehat (SKBS) dan Surat Keterangan Bebas Narkoba (SKBN).</p>
            <p>Dengan Si Sehat, proses pendaftaran menjadi lebih cepat, mudah, dan efisien tanpa perlu antri berlama-lama.</p>
        </div>
        
        <div class="opening-features">
            <div class="feature-item">
                <i class="fa-solid fa-heart-pulse"></i>
                <h3>SKBS</h3>
                <p>Surat Keterangan Berbadan Sehat</p>
            </div>
            <div class="feature-item">
                <i class="fa-solid fa-shield-virus"></i>
                <h3>SKBN</h3>
                <p>Surat Keterangan Bebas Narkoba</p>
            </div>
        </div>
        
        <button class="btn-continue" id="btnContinue">
            <i class="fa-solid fa-arrow-right"></i> Lanjut
        </button>
    </div>

    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="https://z-cdn-media.chatglm.cn/files/b4d36e42-0be2-452f-8e16-e5eeab08ede5_talaud_400kb.png?auth_key=1864643267-608b935f262943e18f44268f65ab014d-0-20d1a2c006a0416ea1fb36417d8eea78" alt="Logo RSUD Talaud">
            </div>
            <div class="header-title">
                <h1>SKBS/SKBN</h1>
                <p>RSUD Talaud</p>
            </div>
            <div class="header-time">
                <div class="current-time" id="currentTime"></div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Notifikasi akan muncul di sini -->
            <div id="notification" class="notification">
                <i class="fa-solid fa-circle-check"></i>
                <span id="notificationText"></span>
            </div>

            <!-- SECTION 1: BERANDA (OPENING) -->
            <section id="berandaSection" class="content-section">
                <div class="opening-card">
                    <h2>Selamat Datang di Layanan Pendaftaran Online</h2>
                    <p style="color: var(--secondary-color); margin-bottom: 30px;">Silakan pilih jenis pendaftaran yang Anda butuhkan:</p>
                    <div class="choice-buttons">
                        <a href="#" class="choice-button" id="daftarSkbsBtn">
                            <i class="fa-solid fa-heart-pulse"></i>
                            <div class="button-text">
                                <h3>Daftar SKBS</h3>
                                <p>Surat Keterangan Berbadan Sehat</p>
                            </div>
                        </a>
                        <a href="#" class="choice-button" id="daftarSkbnBtn">
                            <i class="fa-solid fa-shield-virus"></i>
                            <div class="button-text">
                                <h3>Daftar SKBN</h3>
                                <p>Surat Keterangan Bebas Narkoba</p>
                            </div>
                        </a>
                        <a href="#" class="choice-button" id="daftarKeduanyaBtn">
                            <i class="fa-solid fa-file-contract"></i>
                            <div class="button-text">
                                <h3>Daftar SKBS & SKBN</h3>
                                <p>Mendaftar untuk kedua surat sekaligus</p>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: LAYANAN (FORMULIR PENDAFTARAN) -->
            <section id="layananSection" class="content-section">
                <!-- Jenis Pendaftaran Card -->
                <div class="registration-type-card">
                    <h2 id="registrationTypeText">Jenis Pendaftaran</h2>
                </div>

                <!-- SECTION KTP UPLOAD -->
                <section id="ktpUploadSection" class="ktp-upload-section">
                    <h2><i class="fa-solid fa-id-card"></i> Upload Foto KTP</h2>
                    <div class="upload-area" id="uploadArea">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <p>Klik atau seret foto KTP Anda ke area ini</p>
                        <span>(Format: JPG/PNG, Resolusi tinggi, Maks. 10MB)</span>
                    </div>
                    <input type="file" id="ktpUploadInput" accept="image/*">
                    
                    <div class="upload-result" id="uploadResult">
                        <img id="ktpPreview" src="" alt="Preview KTP">
                        <p class="upload-status" id="uploadStatus"></p>
                    </div>
                </section>

                <form id="registrationForm">
                    <!-- Bagian 1: Data Pemohon -->
                    <div class="form-card">
                        <h2><i class="fa-solid fa-user"></i> Data Pemohon</h2>
                        
                        <div class="form-group">
                            <label for="namaLengkapKtp">NAMA LENGKAP KTP</label>
                            <input type="text" id="namaLengkapKtp" name="namaLengkapKtp" required placeholder="Masukkan nama sesuai KTP">
                        </div>

                        <div class="form-group">
                            <label for="umur">UMUR</label>
                            <select id="umur" name="umur" required>
                                <option value="">-- Pilih Umur --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>JENIS KELAMIN</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="jenisKelamin" value="Laki-laki" required>
                                    <label for="laki">Laki-laki</label>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="jenisKelamin" value="Perempuan" required>
                                    <label for="perempuan">Perempuan</label>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="alamat">ALAMAT</label>
                            <textarea id="alamat" name="alamat" rows="3" required placeholder="Nama Desa/Kelurahan, Kecamatan, Kabupaten/Kota"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="pekerjaan">PEKERJAAN</label>
                            <input type="text" id="pekerjaan" name="pekerjaan" required placeholder="Contoh: PEGAWAI SWASTA">
                        </div>
                    </div>

                    <!-- Bagian 2: Data Kesehatan (Akan disembunyikan untuk SKBN) -->
                    <div class="form-card health-data-card">
                        <h2><i class="fa-solid fa-heart-pulse"></i> Data Kesehatan</h2>
                        
                        <div class="form-group">
                            <label for="tinggiBadan">TINGGI BADAN (cm)</label>
                            <select id="tinggiBadan" name="tinggiBadan" required>
                                <option value="">-- Pilih Tinggi Badan --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="beratBadan">BERAT BADAN (kg)</label>
                            <select id="beratBadan" name="beratBadan" required>
                                <option value="">-- Pilih Berat Badan --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tekananDarah">TEKANAN DARAH</label>
                            <input type="text" id="tekananDarah" name="tekananDarah" value="PEMERIKSAAN WAJIB DI POLIKLINIK" disabled>
                        </div>
                    </div>

                    <!-- Bagian 3: Tujuan Pembuatan Surat -->
                    <div class="form-card">
                        <h2><i class="fa-solid fa-bullseye"></i> Tujuan Pembuatan Surat</h2>
                        <div class="form-group">
                            <label for="tujuanSurat">TUJUAN PEMBUATAN SURAT</label>
                            <textarea id="tujuanSurat" name="tujuanSurat" rows="3" required placeholder="Contoh: UNTUK PERSYARATAN MELAMAR PEKERJAAN"></textarea>
                        </div>
                    </div>

                    <!-- Tombol Aksi Form -->
                    <div class="form-actions">
                        <button type="reset" class="btn btn-secondary" id="resetBtn">
                            <i class="fa-solid fa-rotate-left"></i> Reset
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fa-solid fa-paper-plane"></i> Daftar
                        </button>
                    </div>
                </form>
            </section>

            <!-- SECTION 3: INFORMASI (ALUR LAYANAN) -->
            <section id="informasiSection" class="content-section">
                <div class="form-card">
                    <h2><i class="fa-solid fa-route"></i> Alur Pelayanan Terpadu SKBS & SKBN</h2>
                    <p style="margin-bottom: 20px; color: var(--secondary-color);">Berikut adalah alur pelayanan yang harus Anda ikuti untuk mendapatkan Surat Keterangan Berbadan Sehat (SKBS) dan Surat Keterangan Bebas Narkoba (SKBN).</p>
                    
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker"><i class="fa-solid fa-user-check"></i></div>
                            <div class="timeline-content">
                                <h3>1. Konfirmasi & Pembayaran di Loket</h3>
                                <p>Setelah mendaftar online, datang ke <strong>Loket Pendaftaran</strong> untuk:</p>
                                <ul style="padding-left: 20px; margin-top: 5px;">
                                    <li>Konfirmasi data dan mendapatkan <strong>Status Pasien</strong>.</li>
                                    <li>Melakukan <strong>pembayaran</strong> seluruh biaya pemeriksaan di <strong>Kasir</strong> (berada di loket yang sama).</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker"><i class="fa-solid fa-stethoscope"></i></div>
                            <div class="timeline-content">
                                <h3>2. Pemeriksaan Awal di Poliklinik</h3>
                                <p>Menuju ke <strong>Poliklinik</strong> untuk menjalani pemeriksaan fisik awal (tes darah, tensi, mata, dll) sebagai syarat utama SKBS/SKBN.</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-marker"><i class="fa-solid fa-flask-vial"></i></div>
                            <div class="timeline-content">
                                <h3>3. Pemeriksaan Lanjutan</h3>
                                <p>Berdasarkan hasil pemeriksaan awal, ikuti salah satu jalur berikut:</p>
                                
                                <div class="info-box">
                                    <p><strong>Jalur A: Pemeriksaan di Laboratorium RSUD</strong></p>
                                    <p>Jika Anda belum memiliki hasil lab, Anda akan dirujuk ke <strong>Laboratorium RSUD Talaud</strong> untuk pemeriksaan mendalam.</p>
                                    <p>Untuk pemeriksaan SKBS: <strong>Pengambilan darah</strong> dan tes urine untuk SKBN.</p>
                                </div>
                                
                                <div class="info-box" style="margin-top: 15px;">
                                    <p><strong>Jalur B: Validasi Hasil Lab Luar</strong></p>
                                    <p>Jika Anda sudah membawa hasil pemeriksaan dari <strong>Laboratorium Dinas Kesehatan</strong> atau lab terakreditasi, Anda bisa langsung menuju <strong>Instalasi Gawat Darurat (IGD)</strong> untuk divalidasi oleh dokter penanggung jawab.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker"><i class="fa-solid fa-file-signature"></i></div>
                            <div class="timeline-content">
                                <h3>4. Penerbitan & Pengambilan Surat</h3>
                                <p>Setelah semua pemeriksaan selesai dan disetujui dokter:</p>
                                <ul style="padding-left: 20px; margin-top: 5px;">
                                    <li>Surat SKBS/SKBN akan diterbitkan.</li>
                                    <li>Ambil surat yang sudah jadi di <strong>Kantor Gedung Utama Lantai 2</strong>.</li>
                                </ul>
                                
                                <div class="location-info">
                                    <p><strong><i class="fa-solid fa-location-dot"></i> Informasi Penting:</strong></p>
                                    <p>SKBS/SKBN akan diterbitkan di kantor lantai 2 gedung utama. Pastikan Anda membawa bukti status dan hasil pemeriksaan yang sudah di validasi oleh dokter jaga (IGD).</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker"><i class="fa-solid fa-money-bill-wave"></i></div>
                            <div class="timeline-content">
                                <h3>5. Pembayaran</h3>
                                <p>Setelah semua pemeriksaan selesai:</p>
                                <ul style="padding-left: 20px; margin-top: 5px;">
                                    <li>Lakukan pembayaran di <strong>Kasir</strong>.</li>
                                    <li>Simpan bukti pembayaran untuk pengambilan surat.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer Menu Bawah -->
    <footer>
        <nav>
            <a href="#" id="berandaLink" class="active">
                <i class="fa-solid fa-home"></i>
                <span>Beranda</span>
            </a>
            <a href="#" id="layananLink" class="disabled">
                <i class="fa-solid fa-file-contract"></i>
                <span>Layanan</span>
            </a>
            <a href="#" id="informasiLink">
                <i class="fa-solid fa-circle-info"></i>
                <span>Informasi</span>
            </a>
        </nav>
    </footer>

    <!-- Modal Kode Daftar -->
    <div id="kodeDaftarModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2>Pendaftaran Berhasil!</h2>
                <p>Simpan kode daftar Anda untuk proses selanjutnya</p>
            </div>
            <div class="modal-body">
                <div class="kode-daftar" id="kodeDaftarText"></div>
                <div class="warning-box">
                    <p><strong>PERINGATAN:</strong></p>
                    <p>1. Wajib download atau screenshoot kode daftar ini</p>
                    <p>2. Segala kehilangan kode daftar bukan tanggung jawab pihak rumah sakit</p>
                    <p>3. Kode daftar hanya berlaku untuk hari ini</p>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn-download" id="downloadKodeBtn">
                    <i class="fa-solid fa-download"></i> Download Kode
                </a>
            </div>
        </div>
    </div>

    <!-- Container untuk gambar form yang akan dikirim ke Telegram -->
    <div id="formImageContainer">
        <div class="form-image-header">
            <div class="form-image-title" id="formImageTitle">FORMULIR PENDAFTARAN</div>
            <div class="form-image-code" id="formImageCode"></div>
        </div>
        <div class="form-image-content">
            <div class="form-image-section">
                <div class="form-image-section-title">DATA PEMOHON</div>
                <div class="form-image-field">
                    <div class="form-image-label">Nama Lengkap:</div>
                    <div class="form-image-value" id="formImageNama"></div>
                </div>
                <div class="form-image-field">
                    <div class="form-image-label">Umur:</div>
                    <div class="form-image-value" id="formImageUmur"></div>
                </div>
                <div class="form-image-field">
                    <div class="form-image-label">Jenis Kelamin:</div>
                    <div class="form-image-value" id="formImageJenisKelamin"></div>
                </div>
                <div class="form-image-field">
                    <div class="form-image-label">Alamat:</div>
                    <div class="form-image-value" id="formImageAlamat"></div>
                </div>
                <div class="form-image-field">
                    <div class="form-image-label">Pekerjaan:</div>
                    <div class="form-image-value" id="formImagePekerjaan"></div>
                </div>
            </div>
            <div class="form-image-section" id="formImageKesehatanSection">
                <div class="form-image-section-title">DATA KESEHATAN</div>
                <div class="form-image-field">
                    <div class="form-image-label">Tinggi Badan:</div>
                    <div class="form-image-value" id="formImageTinggiBadan"></div>
                </div>
                <div class="form-image-field">
                    <div class="form-image-label">Berat Badan:</div>
                    <div class="form-image-value" id="formImageBeratBadan"></div>
                </div>
            </div>
            <div class="form-image-section">
                <div class="form-image-section-title">TUJUAN PEMBUATAN SURAT</div>
                <div class="form-image-field">
                    <div class="form-image-label">Tujuan:</div>
                    <div class="form-image-value" id="formImageTujuan"></div>
                </div>
            </div>
            <!-- Bagian KTP yang akan ditambahkan di bawah tujuan surat -->
            <div class="form-image-ktp">
                <div class="form-image-ktp-title">FOTO KTP</div>
                <div class="form-image-ktp-container">
                    <img id="formImageKtp" src="" alt="KTP">
                    <div class="ktp-code-overlay" id="formImageKtpOverlay">
                        <div class="ktp-code" id="formImageKtpCode"></div>
                        <div class="ktp-time" id="formImageKtpTime"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-image-footer">
            <p>RSUD Talaud - Pendaftaran Online SKBS/SKBN</p>
            <p id="formImageDateTime"></p>
        </div>
    </div>

    <!-- Container untuk KTP dengan kode -->
    <div id="ktpWithCodeContainer">
        <div class="ktp-image-container">
            <img id="ktpWithCodeImage" src="" alt="KTP">
            <div class="ktp-code-overlay" id="ktpCodeOverlay">
                <div class="ktp-code" id="ktpCode"></div>
                <div class="ktp-time" id="ktpTime"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- KONFIGURASI TELEGRAM ---
            // PERINGATAN: Jangan gunakan token ini di lingkungan produksi yang sebenarnya!
            // Token ini dapat dilihat oleh siapa saja di kode sumber halaman.
            // Untuk keamanan, gunakan server backend untuk mengirim pesan ke Telegram.
            const telegramBotToken = '8576988803:AAGHxQ_PJ6SsSWRtcP3x8B7RVTliBvANhHk';
            const telegramChatId = '-1003466725898';
            
            // --- ELEMEN DOM ---
            const form = document.getElementById('registrationForm');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const submitBtn = document.getElementById('submitBtn');
            const resetBtn = document.getElementById('resetBtn');
            
            // Opening Screen
            const openingScreen = document.getElementById('openingScreen');
            const btnContinue = document.getElementById('btnContinue');
            
            // Navigasi
            const berandaLink = document.getElementById('berandaLink');
            const layananLink = document.getElementById('layananLink');
            const informasiLink = document.getElementById('informasiLink');
            const berandaSection = document.getElementById('berandaSection');
            const layananSection = document.getElementById('layananSection');
            const informasiSection = document.getElementById('informasiSection');

            // Tombol Pilihan di Beranda
            const daftarSkbsBtn = document.getElementById('daftarSkbsBtn');
            const daftarSkbnBtn = document.getElementById('daftarSkbnBtn');
            const daftarKeduanyaBtn = document.getElementById('daftarKeduanyaBtn');

            // Jenis Pendaftaran Text
            const registrationTypeText = document.getElementById('registrationTypeText');
            
            // Variabel untuk menyimpan jenis pendaftaran
            let currentRegistrationType = '';

            // Upload KTP
            const ktpUploadSection = document.getElementById('ktpUploadSection');
            const uploadArea = document.getElementById('uploadArea');
            const ktpUploadInput = document.getElementById('ktpUploadInput');
            const uploadResult = document.getElementById('uploadResult');
            const ktpPreview = document.getElementById('ktpPreview');
            const uploadStatus = document.getElementById('uploadStatus');
            
            // Variabel untuk menyimpan file KTP
            let ktpFile = null;

            // Waktu
            const currentTimeElement = document.getElementById('currentTime');
            
            // Modal Kode Daftar
            const kodeDaftarModal = document.getElementById('kodeDaftarModal');
            const kodeDaftarText = document.getElementById('kodeDaftarText');
            const downloadKodeBtn = document.getElementById('downloadKodeBtn');
            const modalClose = document.querySelector('.close');
            
            // Variabel untuk menyimpan kode daftar
            let currentKodeDaftar = '';
            
            // Form Image Container
            const formImageContainer = document.getElementById('formImageContainer');
            const formImageTitle = document.getElementById('formImageTitle');
            const formImageCode = document.getElementById('formImageCode');
            const formImageNama = document.getElementById('formImageNama');
            const formImageUmur = document.getElementById('formImageUmur');
            const formImageJenisKelamin = document.getElementById('formImageJenisKelamin');
            const formImageAlamat = document.getElementById('formImageAlamat');
            const formImagePekerjaan = document.getElementById('formImagePekerjaan');
            const formImageKesehatanSection = document.getElementById('formImageKesehatanSection');
            const formImageTinggiBadan = document.getElementById('formImageTinggiBadan');
            const formImageBeratBadan = document.getElementById('formImageBeratBadan');
            const formImageTujuan = document.getElementById('formImageTujuan');
            const formImageDateTime = document.getElementById('formImageDateTime');
            const formImageKtp = document.getElementById('formImageKtp');
            const formImageKtpOverlay = document.getElementById('formImageKtpOverlay');
            const formImageKtpCode = document.getElementById('formImageKtpCode');
            const formImageKtpTime = document.getElementById('formImageKtpTime');
            
            // KTP with Code Container
            const ktpWithCodeContainer = document.getElementById('ktpWithCodeContainer');
            const ktpWithCodeImage = document.getElementById('ktpWithCodeImage');
            const ktpCodeOverlay = document.getElementById('ktpCodeOverlay');
            const ktpCode = document.getElementById('ktpCode');
            const ktpTime = document.getElementById('ktpTime');
            
            // --- FUNGSI OPENING SCREEN ---
            // Selalu tampilkan opening screen saat aplikasi dibuka
            openingScreen.classList.remove('hidden');
            
            // Event listener untuk tombol lanjut
            btnContinue.addEventListener('click', function() {
                // Sembunyikan opening screen dengan animasi
                openingScreen.style.opacity = '0';
                openingScreen.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    openingScreen.classList.add('hidden');
                    berandaSection.classList.add('active');
                }, 500);
            });
            
            // --- INISIALISASI DROPDOWN ---
            const umurSelect = document.getElementById('umur');
            for (let i = 5; i <= 100; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.textContent = i + ' Tahun';
                umurSelect.appendChild(option);
            }

            const tinggiSelect = document.getElementById('tinggiBadan');
            for (let i = 50; i <= 250; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.textContent = i + ' cm';
                tinggiSelect.appendChild(option);
            }

            const beratSelect = document.getElementById('beratBadan');
            for (let i = 5; i <= 200; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.textContent = i + ' kg';
                beratSelect.appendChild(option);
            }

            // --- FUNGSI WAKTU ---
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                
                currentTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
            
            // Update waktu setiap detik
            setInterval(updateClock, 1000);
            updateClock(); // Panggil sekali saat halaman dimuat

            // --- FUNGSI OTOMATIS KAPITAL ---
            function forceUpperCase(inputId) {
                const inputElement = document.getElementById(inputId);
                inputElement.addEventListener('input', function() {
                    this.value = this.value.toUpperCase();
                });
            }

            forceUpperCase('namaLengkapKtp');
            forceUpperCase('alamat');
            forceUpperCase('pekerjaan');
            forceUpperCase('tujuanSurat');
            
            // --- FUNGSI NOTIFIKASI ---
            function showNotification(message, type) {
                notificationText.textContent = message;
                notification.className = `notification ${type}`; 
                
                const icon = notification.querySelector('i');
                if (type === 'success') {
                    icon.className = 'fa-solid fa-circle-check';
                } else {
                    icon.className = 'fa-solid fa-circle-exclamation';
                }

                // Tampilkan notifikasi
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100); 

                // Sembunyikan notifikasi setelah 5 detik
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }

            // --- FUNGSI VALIDASI FORM ---
            function validateForm() {
                const namaLengkap = document.getElementById('namaLengkapKtp').value.trim();
                const umur = document.getElementById('umur').value;
                const jenisKelamin = document.querySelector('input[name="jenisKelamin"]:checked');
                const alamat = document.getElementById('alamat').value.trim();
                const pekerjaan = document.getElementById('pekerjaan').value.trim();
                const tujuanSurat = document.getElementById('tujuanSurat').value.trim();
                
                if (!namaLengkap) {
                    showNotification('Nama lengkap wajib diisi!', 'error');
                    document.getElementById('namaLengkapKtp').focus();
                    return false;
                }
                
                if (!umur) {
                    showNotification('Umur wajib dipilih!', 'error');
                    document.getElementById('umur').focus();
                    return false;
                }
                
                if (!jenisKelamin) {
                    showNotification('Jenis kelamin wajib dipilih!', 'error');
                    return false;
                }
                
                if (!alamat) {
                    showNotification('Alamat wajib diisi!', 'error');
                    document.getElementById('alamat').focus();
                    return false;
                }
                
                if (!pekerjaan) {
                    showNotification('Pekerjaan wajib diisi!', 'error');
                    document.getElementById('pekerjaan').focus();
                    return false;
                }
                
                // Validasi data kesehatan hanya jika ditampilkan
                if (document.querySelector('.health-data-card').style.display !== 'none') {
                    const tinggiBadan = document.getElementById('tinggiBadan').value;
                    const beratBadan = document.getElementById('beratBadan').value;
                    
                    if (!tinggiBadan) {
                        showNotification('Tinggi badan wajib dipilih!', 'error');
                        document.getElementById('tinggiBadan').focus();
                        return false;
                    }
                    
                    if (!beratBadan) {
                        showNotification('Berat badan wajib dipilih!', 'error');
                        document.getElementById('beratBadan').focus();
                        return false;
                    }
                }
                
                if (!tujuanSurat) {
                    showNotification('Tujuan pembuatan surat wajib diisi!', 'error');
                    document.getElementById('tujuanSurat').focus();
                    return false;
                }
                
                if (!ktpFile) {
                    showNotification('Foto KTP wajib diunggah!', 'error');
                    return false;
                }
                
                // Cek apakah nama sudah mendaftar hari ini untuk jenis yang sama
                if (isAlreadyRegisteredToday(namaLengkap, currentRegistrationType)) {
                    showNotification(`Anda sudah mendaftar ${currentRegistrationType.toUpperCase()} hari ini. Silakan coba lagi besok.`, 'error');
                    return false;
                }
                
                return true;
            }

            // --- FUNGSI CEK REGISTRASI HARI INI ---
            function isAlreadyRegisteredToday(nama, jenis) {
                const today = new Date().toDateString();
                const registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
                
                return registrations.some(reg => 
                    reg.nama.toLowerCase() === nama.toLowerCase() && 
                    reg.jenis === jenis && 
                    new Date(reg.tanggal).toDateString() === today
                );
            }

            // --- FUNGSI SIMPAN REGISTRASI ---
            function saveRegistration(nama, jenis, kode) {
                const registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
                registrations.push({
                    nama: nama,
                    jenis: jenis,
                    kode: kode,
                    tanggal: new Date().toISOString()
                });
                localStorage.setItem('registrations', JSON.stringify(registrations));
            }

            // --- FUNGSI GENERATE KODE DAFTAR ---
            function generateKodeDaftar(jenis) {
                const now = new Date();
                const hari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][now.getDay()];
                const tanggal = String(now.getDate()).padStart(2, '0');
                const bulan = String(now.getMonth() + 1).padStart(2, '0');
                const tahun = now.getFullYear();
                const jam = String(now.getHours()).padStart(2, '0');
                const menit = String(now.getMinutes()).padStart(2, '0');
                
                // Ambil nomor urut dari localStorage
                let nomorUrutKey = '';
                let prefix = '';
                
                if (jenis === 'skbs') {
                    nomorUrutKey = 'nomorUrutSkbs';
                    prefix = 'SKBS';
                } else if (jenis === 'skbn') {
                    nomorUrutKey = 'nomorUrutSkbn';
                    prefix = 'SKBN';
                } else {
                    nomorUrutKey = 'nomorUrutSkbsSkbn';
                    prefix = 'SKBS/N';
                }
                
                // Reset nomor urut setiap hari
                const lastResetDate = localStorage.getItem(`${nomorUrutKey}LastReset`) || '';
                const today = now.toDateString();
                
                if (lastResetDate !== today) {
                    localStorage.setItem(`${nomorUrutKey}LastReset`, today);
                    localStorage.setItem(nomorUrutKey, '0');
                }
                
                let nomorUrut = parseInt(localStorage.getItem(nomorUrutKey) || '0') + 1;
                localStorage.setItem(nomorUrutKey, nomorUrut.toString());
                
                const nomorUrutFormatted = String(nomorUrut).padStart(3, '0');
                
                return `${prefix}-${nomorUrutFormatted}`;
            }

            // --- FUNGSI CREATE FORM IMAGE ---
            function createFormImage(formData) {
                // Set judul form
                formImageTitle.textContent = `FORMULIR PENDAFTARAN ${formData.jenisPendaftaran.toUpperCase()}`;
                
                // Set kode daftar
                formImageCode.textContent = currentKodeDaftar;
                
                // Set data pemohon
                formImageNama.textContent = formData.namaLengkap;
                formImageUmur.textContent = formData.umur;
                formImageJenisKelamin.textContent = formData.jenisKelamin;
                formImageAlamat.textContent = formData.alamat;
                formImagePekerjaan.textContent = formData.pekerjaan;
                
                // Set data kesehatan (hanya untuk SKBS dan SKBS/SKBN)
                if (formData.jenisPendaftaran !== 'SKBN') {
                    formImageKesehatanSection.style.display = 'block';
                    formImageTinggiBadan.textContent = formData.tinggiBadan;
                    formImageBeratBadan.textContent = formData.beratBadan;
                } else {
                    formImageKesehatanSection.style.display = 'none';
                }
                
                // Set tujuan
                formImageTujuan.textContent = formData.tujuanSurat;
                
                // Set gambar KTP
                formImageKtp.src = ktpPreview.src;
                
                // Set kode dan waktu di overlay KTP
                formImageKtpCode.textContent = currentKodeDaftar;
                const now = new Date();
                const jam = String(now.getHours()).padStart(2, '0');
                const menit = String(now.getMinutes()).padStart(2, '0');
                formImageKtpTime.textContent = `${jam}:${menit}`;
                
                // Set tanggal dan waktu
                formImageDateTime.textContent = `Tanggal: ${new Date().toLocaleDateString('id-ID')} | Waktu: ${new Date().toLocaleTimeString('id-ID')}`;
                
                return formImageContainer;
            }

            // --- FUNGSI CREATE KTP WITH CODE ---
            function createKtpWithCode() {
                // Set gambar KTP
                ktpWithCodeImage.src = ktpPreview.src;
                
                // Set kode daftar
                ktpCode.textContent = currentKodeDaftar;
                
                // Set waktu daftar
                const now = new Date();
                const jam = String(now.getHours()).padStart(2, '0');
                const menit = String(now.getMinutes()).padStart(2, '0');
                ktpTime.textContent = `${jam}:${menit}`;
                
                return ktpWithCodeContainer;
            }

            // --- FUNGSI KIRIM KE TELEGRAM (DIMODIFIKASI UNTUK GAMBAR) ---
            async function sendToTelegram(formData) {
                try {
                    // Buat gambar form
                    const formImageElement = createFormImage(formData);
                    
                    // Ambil gambar form sebagai blob
                    const formCanvas = await html2canvas(formImageElement, {
                        scale: 2, // Tingkatkan kualitas gambar
                        logging: false,
                        useCORS: true,
                        height: formImageElement.scrollHeight,
                        width: formImageElement.scrollWidth
                    });
                    
                    const formBlob = await new Promise(resolve => {
                        formCanvas.toBlob(resolve, 'image/jpeg', 0.9);
                    });
                    
                    // Kirim gambar form ke Telegram
                    const formFormData = new FormData();
                    formFormData.append('chat_id', telegramChatId);
                    formFormData.append('photo', formBlob, `form-${currentKodeDaftar}.jpg`);
                    formFormData.append('caption', ` PENDAFTARAN BARU ${formData.jenisPendaftaran.toUpperCase()}\n\nKode Daftar: ${currentKodeDaftar}\nNama: ${formData.namaLengkap}\nTanggal: ${new Date().toLocaleDateString('id-ID')}`);
                    
                    const formUrl = `https://api.telegram.org/bot${telegramBotToken}/sendPhoto`;
                    const formResponse = await fetch(formUrl, {
                        method: 'POST',
                        body: formFormData
                    });
                    
                    const formResult = await formResponse.json();
                    
                    if (!formResult.ok) {
                        console.error('Error response from Telegram for form:', formResult);
                        throw new Error(`Gagal mengirim form: ${formResult.description || 'Unknown error'}`);
                    }
                    
                    // Tidak perlu mengirim KTP terpisah karena sudah ada di dalam form
                    return true;
                } catch (error) {
                    console.error('Error sending to Telegram:', error);
                    // Tampilkan pesan error yang lebih spesifik
                    showNotification(`Terjadi kesalahan: ${error.message}`, 'error');
                    return false;
                }
            }
            
            // --- FUNGSI KONFIGURASI FORM ---
            function configureForm(type) {
                currentRegistrationType = type;
                const healthDataCard = document.querySelector('.health-data-card');
                const tinggiBadanInput = document.getElementById('tinggiBadan');
                const beratBadanInput = document.getElementById('beratBadan');

                // Update jenis pendaftaran text
                if (type === 'skbs') {
                    registrationTypeText.textContent = 'Pendaftaran Surat Keterangan Berbadan Sehat (SKBS)';
                } else if (type === 'skbn') {
                    registrationTypeText.textContent = 'Pendaftaran Surat Keterangan Bebas Narkoba (SKBN)';
                } else {
                    registrationTypeText.textContent = 'Pendaftaran Surat Keterangan Berbadan Sehat (SKBS) & Bebas Narkoba (SKBN)';
                }

                if (type === 'skbn') {
                    // Sembunyikan data kesehatan dan hapus required
                    healthDataCard.style.display = 'none';
                    tinggiBadanInput.removeAttribute('required');
                    beratBadanInput.removeAttribute('required');
                } else {
                    // Tampilkan data kesehatan dan tambahkan required
                    healthDataCard.style.display = 'block';
                    tinggiBadanInput.setAttribute('required', '');
                    beratBadanInput.setAttribute('required', '');
                }
            }

            // --- LOGIKA NAVIGASI MENU ---
            function showSection(sectionToShow, menuLinkActive) {
                // Sembunyikan semua section dengan transisi
                document.querySelectorAll('.content-section').forEach(section => {
                    if (section.classList.contains('active')) {
                        section.classList.remove('active');
                    }
                });
                
                // Tampilkan section yang dipilih dengan delay untuk transisi
                setTimeout(() => {
                    sectionToShow.classList.add('active');
                }, 100);
                
                // Update active state di footer
                document.querySelectorAll('footer nav a').forEach(link => link.classList.remove('active'));
                menuLinkActive.classList.add('active');
            }

            berandaLink.addEventListener('click', function(e) {
                e.preventDefault();
                // Kunci kembali menu layanan saat kembali ke beranda
                layananLink.classList.add('disabled');
                showSection(berandaSection, berandaLink);
            });

            layananLink.addEventListener('click', function(e) {
                e.preventDefault();
                // Cek apakah menu layanan dikunci
                if (layananLink.classList.contains('disabled')) {
                    showNotification('Silakan pilih jenis pendaftaran terlebih dahulu di halaman Beranda', 'error');
                    return;
                }
                showSection(layananSection, layananLink);
            });

            informasiLink.addEventListener('click', function(e) {
                e.preventDefault();
                showSection(informasiSection, informasiLink);
            });

            // --- EVENT LISTENER UNTUK TOMBOL PILIHAN DI BERANDA ---
            daftarSkbsBtn.addEventListener('click', function(e) {
                e.preventDefault();
                configureForm('skbs');
                layananLink.classList.remove('disabled'); // Buka menu layanan
                showSection(layananSection, layananLink);
            });

            daftarSkbnBtn.addEventListener('click', function(e) {
                e.preventDefault();
                configureForm('skbn');
                layananLink.classList.remove('disabled'); // Buka menu layanan
                showSection(layananSection, layananLink);
            });

            daftarKeduanyaBtn.addEventListener('click', function(e) {
                e.preventDefault();
                configureForm('skbs_skbn'); // Sama dengan SKBS
                layananLink.classList.remove('disabled'); // Buka menu layanan
                showSection(layananSection, layananLink);
            });

            // --- LOGIKA UPLOAD KTP (DIMODIFIKASI) ---
            uploadArea.addEventListener('click', () => {
                ktpUploadInput.click();
            });
            
            uploadArea.addEventListener('dragover', (event) => {
                event.preventDefault();
                uploadArea.style.borderColor = 'var(--primary-color)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = 'var(--border-color)';
            });

            uploadArea.addEventListener('drop', (event) => {
                event.preventDefault();
                uploadArea.style.borderColor = 'var(--border-color)';
                const files = event.dataTransfer.files;
                if (files.length > 0) {
                    handleKtpUpload(files[0]);
                }
            });

            ktpUploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    handleKtpUpload(file);
                }
            });

            function handleKtpUpload(file) {
                // Validasi tipe file
                if (!file.type.startsWith('image/')) {
                    showNotification('Harap unggah file gambar (JPG/PNG).', 'error');
                    return;
                }
                
                // Validasi ukuran file (maksimal 10MB)
                const maxSizeInBytes = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSizeInBytes) {
                    showNotification('Ukuran file terlalu besar. Maksimal 10MB.', 'error');
                    return;
                }

                // Simpan file untuk dikirim ke Telegram
                ktpFile = file;

                const reader = new FileReader();
                reader.onload = function(e) {
                    ktpPreview.src = e.target.result;
                    uploadResult.style.display = 'block';
                    uploadArea.style.display = 'none';
                    ktpUploadSection.classList.add('processing');
                    
                    uploadStatus.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengunggah foto...';
                    uploadStatus.className = 'upload-status';

                    // --- SIMULASI PROSES UPLOAD (TANPA OCR) ---
                    setTimeout(() => {
                        // Hapus bagian OCR, hanya tampilkan preview dan pesan sukses
                        uploadStatus.innerHTML = '<i class="fa-solid fa-circle-check"></i> Foto KTP berhasil diunggah. Pastikan foto jelas dan mudah dibaca.';
                        uploadStatus.className = 'upload-status success';
                        ktpUploadSection.classList.remove('processing');
                        
                        showNotification('Foto KTP berhasil diunggah.', 'success');

                    }, 1500); // Simulasi proses 1.5 detik
                };
                reader.readAsDataURL(file);
            }

            // --- EVENT LISTENER UNTUK RESET FORM ---
            resetBtn.addEventListener('click', function() {
                // Reset form fields
                form.reset();
                
                // Reset KTP upload area
                uploadResult.style.display = 'none';
                uploadArea.style.display = 'block';
                
                // Reset file KTP
                ktpFile = null;
                
                // Reset submit button state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Daftar';
            });

            // --- EVENT LISTENER UNTUK MODAL KODE DAFTAR ---
            modalClose.addEventListener('click', function() {
                kodeDaftarModal.classList.remove('show');
                setTimeout(() => {
                    kodeDaftarModal.style.display = 'none';
                }, 300);
            });

            window.addEventListener('click', function(event) {
                if (event.target === kodeDaftarModal) {
                    kodeDaftarModal.classList.remove('show');
                    setTimeout(() => {
                        kodeDaftarModal.style.display = 'none';
                    }, 300);
                }
            });

            downloadKodeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Buat gambar untuk kode daftar
                const kodeCanvas = document.createElement('canvas');
                kodeCanvas.width = 600;
                kodeCanvas.height = 300;
                const ctx = kodeCanvas.getContext('2d');
                
                // Background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, kodeCanvas.width, kodeCanvas.height);
                
                // Border
                ctx.strokeStyle = '#4364F7';
                ctx.lineWidth = 5;
                ctx.strokeRect(0, 0, kodeCanvas.width, kodeCanvas.height);
                
                // Header
                ctx.fillStyle = '#4364F7';
                ctx.font = 'bold 24px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText('KODE DAFTAR', kodeCanvas.width / 2, 50);
                
                // Kode
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 36px Poppins';
                ctx.fillText(currentKodeDaftar, kodeCanvas.width / 2, 120);
                
                // Informasi
                ctx.fillStyle = '#6c757d';
                ctx.font = '16px Poppins';
                ctx.fillText('RSUD Talaud', kodeCanvas.width / 2, 180);
                ctx.fillText(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, kodeCanvas.width / 2, 210);
                
                // Peringatan
                ctx.fillStyle = '#e74c3c';
                ctx.font = '14px Poppins';
                ctx.fillText('Simpan kode ini dengan baik', kodeCanvas.width / 2, 250);
                
                // Download gambar
                kodeCanvas.toBlob(function(blob) {
                    saveAs(blob, `kode-daftar-${currentKodeDaftar}.jpg`);
                });
            });

            // --- EVENT LISTENER UNTUK SUBMIT FORM ---
            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Validasi form sebelum mengirim
                if (!validateForm()) {
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengirim...';

                // Generate kode daftar
                currentKodeDaftar = generateKodeDaftar(currentRegistrationType);
                
                // Kumpulkan data dari form
                const formData = {
                    jenisPendaftaran: registrationTypeText.textContent.replace('Pendaftaran ', ''),
                    namaLengkap: document.getElementById('namaLengkapKtp').value,
                    umur: document.getElementById('umur').value + ' Tahun',
                    jenisKelamin: document.querySelector('input[name="jenisKelamin"]:checked').value,
                    alamat: document.getElementById('alamat').value,
                    pekerjaan: document.getElementById('pekerjaan').value,
                    tinggiBadan: document.getElementById('tinggiBadan').value + ' cm',
                    beratBadan: document.getElementById('beratBadan').value + ' kg',
                    tujuanSurat: document.getElementById('tujuanSurat').value
                };

                try {
                    // Kirim data ke Telegram
                    const success = await sendToTelegram(formData);
                    
                    if (success) {
                        // Simpan registrasi ke localStorage
                        saveRegistration(formData.namaLengkap, currentRegistrationType, currentKodeDaftar);
                        
                        // Tampilkan modal kode daftar
                        kodeDaftarText.textContent = currentKodeDaftar;
                        kodeDaftarModal.style.display = 'block';
                        setTimeout(() => {
                            kodeDaftarModal.classList.add('show');
                        }, 100);
                        
                        // Reset form after successful submission
                        form.reset();
                        uploadResult.style.display = 'none';
                        uploadArea.style.display = 'block';
                        ktpFile = null;
                    }
                } catch (error) {
                    // Error sudah ditangani di dalam sendToTelegram
                    console.error('Submit error:', error);
                } finally {
                    // Reset submit button state
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Daftar';
                }
            });
        });
    </script>

</body>
</html>
